# report_srv

Этот проект демонстрирует начальную структуру Go-приложения, построенную по принципам
"Чистой архитектуры" и DDD. Сервис запускает HTTP API и генерирует отчёты по запросу.

Сервис предназначен для генерации отчётов на основе шаблонов Word или XLSX,
которые заполняются результатами выполнения SQL‑запросов. Шаблоны хранятся в
бакете S3 (здесь его роль выполняет локальная директория), а метаданные о том,
какой шаблон и какие запросы относятся к отчёту, хранятся в базе данных.
Подключение к различным СУБД осуществляется через указание SQL‑драйвера и DSN в настройках.

```
cmd/                - точки входа приложения
internal/
  config/           - сущности конфигурации
  domain/           - доменные модели
  infrastructure/   - внешние интеграции
  interface/        - транспортный слой (например HTTP)
  usecase/          - бизнес‑логика приложения
```

Настройки считываются с помощью Viper из файла `config.yaml` и из переменных окружения:

```
APP_DATABASE_DRIVER   - SQL‑драйвер (postgres, mysql и т.д.)
APP_DATABASE_DSN      - строка подключения к базе
APP_STORAGE_BASEPATH  - путь к каталогу с шаблонами
APP_SERVER_ADDRESS    - адрес HTTP-сервера
```

Переменные можно указать в файле `.env`. При запуске приложение пытается
загрузить этот файл и установить значения, если они ещё не определены.

Это позволяет использовать сервис с разными СУБД и хранилищами шаблонов.

Для локального запуска предусмотрен `docker-compose.yml`, который поднимает
PostgreSQL и сам сервис:

```bash
docker compose up --build
```
Compose автоматически читает переменные из файла `.env`, поэтому он должен
располагаться рядом с `docker-compose.yml`.

После запуска HTTP-сервер будет доступен по адресу, указанному в `APP_SERVER_ADDRESS`.
Заполнение шаблонов XLSX поддерживается: первая строка файла должна содержать
имена столбцов в формате `{{column}}`.
